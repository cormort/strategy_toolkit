<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商業生命週期策略工具 (已修正 v2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    
    <style>
        /* --- 全局設定 --- */
        * { box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; }
        
        /* --- 修正 2.3: Textarea 樣式 (min-height -> 120px) --- */
        /* --- 修正 3.1: 視覺一致性 (顏色更新為 #3498db) --- */
        .worksheet-input { 
            margin-top: 0.375rem; 
            padding: 0.875rem; 
            display: block; 
            width: 100%; 
            border-radius: 0.5rem; 
            border: 1.5px solid #cbd5e1; 
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); 
            font-size: 0.95rem; 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            background: linear-gradient(to bottom, #f8fafc, #ffffff);
            min-height: 120px; /* 依照建議 2.3 調整 */
            resize: vertical; 
            line-height: 1.6;
        }
        
        .worksheet-input:hover { 
            border-color: #94a3b8; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }
        
        .worksheet-input:focus { 
            border-color: #3498db; /* 依照建議 3.1 調整 */
            outline: none; 
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15), 0 2px 8px rgba(52, 152, 219, 0.1); /* 依照建議 3.1 調整 */
            background: #ffffff;
        }
        
        /* --- Tab 樣式 (顏色更新) --- */
        .tab-buttons { 
            display: flex; 
            border-bottom: 2px solid #e2e8f0; 
            margin-bottom: 1.5rem; 
            overflow-x: auto; 
            white-space: nowrap; 
            gap: 0.25rem;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab-buttons::-webkit-scrollbar { height: 6px; }
        .tab-buttons::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .tab-buttons::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

        .tab-btn { 
            flex-shrink: 0; 
            padding: 0.875rem 1.25rem; 
            border-bottom: 3px solid transparent; 
            font-weight: 500; 
            font-size: 0.95rem; 
            cursor: pointer; 
            transition: all 0.2s ease; 
            border-radius: 0.5rem 0.5rem 0 0; 
        }
        
        .tab-btn.active { 
            border-color: #3498db; /* 依照建議 3.1 調整 */
            color: #2980b9; /* 依照建議 3.1 調整 (較深) */
            font-weight: 600; 
            background: linear-gradient(to bottom, #eaf5fb, #ffffff); /* 依照建議 3.1 調整 (較淺) */
            box-shadow: 0 -2px 8px rgba(52, 152, 219, 0.1); /* 依照建議 3.1 調整 */
        }
        
        .tab-btn.inactive { 
            border-color: transparent; 
            color: #64748b; 
        }
        
        .tab-btn.inactive:hover { 
            color: #334155; 
            background-color: #f8fafc;
            border-color: #cbd5e1;
        }
        
        .tab-content { 
            display: none; 
            animation: fadeIn 0.3s ease-out; 
        }
        
        .tab-content.active { 
            display: block; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(8px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        /* --- 階段重點卡片 (顏色更新) --- */
        .stage-focus { 
            background: linear-gradient(135deg, #eaf5fb 0%, #f4f9fc 100%); /* 依照建議 3.1 調整 */
            border: 2px solid #a9d6f5; /* 依照建議 3.1 調整 (較淺) */
            border-radius: 0.75rem; 
            padding: 1.25rem 1.5rem; 
            margin-bottom: 2rem; 
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.1); /* 依照建議 3.1 調整 */
        }
        
        .stage-focus h3 { 
            font-size: 1.125rem; 
            font-weight: 600; 
            color: #2980b9; /* 依照建議 3.1 調整 (較深) */
            margin-bottom: 0.75rem; 
        }
        
        .stage-focus ul { 
            list-style: none; 
            margin-left: 0;
            color: #2980b9; /* 依照建議 3.1 調整 */
            font-size: 0.95rem; 
        }
        
        .stage-focus li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.5rem;
        }
        
        .stage-focus li:before {
            content: "▸";
            position: absolute;
            left: 0;
            color: #3498db; /* 依照建議 3.1 調整 */
            font-weight: bold;
        }

        .stage-section { 
            margin-bottom: 3rem; 
            padding-top: 1rem; 
        }
        
        /* --- 階段標題 (顏色更新) --- */
        .stage-title { 
            font-size: 1.875rem; 
            font-weight: 700; 
            color: #2980b9; /* 依照建議 3.1 調整 (較深) */
            border-bottom: 3px solid #a9d6f5; /* 依照建議 3.1 調整 (較淺) */
            padding-bottom: 0.75rem; 
            margin-bottom: 1.75rem;
            background: linear-gradient(to right, #3498db, #2980b9); /* 依照建議 3.1 調整 */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* --- 工具區塊 (顏色更新) --- */
        .tool-block { 
            margin-bottom: 2.5rem; 
            border-left: 4px solid #3498db; /* 依照建議 3.1 調整 */
            padding-left: 1.25rem;
            background: linear-gradient(to right, rgba(52, 152, 219, 0.03), transparent); /* 依照建議 3.1 調整 */
            border-radius: 0 0.5rem 0.5rem 0;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        
        .tool-label { 
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #334155; 
            margin-bottom: 0.5rem; 
        }
        
        .tool-description { 
            font-size: 0.9rem; 
            color: #64748b; 
            margin-bottom: 1rem; 
            font-style: italic;
        }
        
        .sub-label { 
            font-size: 0.95rem; 
            font-weight: 500; 
            color: #475569; 
            margin-bottom: 0.375rem; 
            display: block; 
        }
        
        .sub-label-hint { 
            font-size: 0.8rem; 
            color: #94a3b8; 
            display: block; 
            margin-top: -2px; 
            margin-bottom: 0.375rem;
        }

        /* --- 修正 2.1 & 2.2: .toolkit 佈局 (更新為 flex-start) --- */
        .toolkit {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* 修正：改為 flex-start (靠左對齊) */
            gap: 20px; /* 依照建議 2.1 調整 */
            margin-top: 0.75rem;
        }
        
        .toolkit > .input-group {
            width: 300px; /* 依照建議 2.2 調整 (固定寬度) */
            max-width: 100%; /* 增加保護，避免在極窄螢幕溢出 */
            margin-bottom: 0; /* 由 gap 控制間距 */
        }
        
        /* .input-group 的原始樣式 */
        .input-group { 
            margin-bottom: 1.25rem; 
        }
        
        .input-group:last-child { 
            margin-bottom: 0; 
        }

        /* --- 修正 3.1 & 3.4: 按鈕顏色一致性 --- */
        .btn-base {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        
        .btn-base:hover {
            transform: translateY(-2px);
        }
        
        .btn-base:active {
            transform: translateY(-1px);
        }

        .btn-blue {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .btn-blue:hover {
            box-shadow: 0 8px 16px rgba(52, 152, 219, 0.3);
        }
        
        /* 舊的 export-btn, save-btn, load-btn 已被 .btn-base 和 .btn-blue 取代 */
        /* 保留 export-btn 的閃光效果 */
        .export-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .export-btn:hover:before {
            left: 100%;
        }
        
        /* --- 響應式調整 (修正 2.4) --- */
        @media print { 
            .no-print { 
                display: none; 
            } 
        }
        
        .analysis-section { 
            margin-bottom: 2.5rem; 
        }
        
        .analysis-h2 { 
            font-size: 1.5rem; 
            font-weight: 600; 
            color: #2980b9; /* 依照建議 3.1 調整 */
            margin-bottom: 1rem; 
            border-left: 4px solid #3498db; /* 依照建議 3.1 調整 */
            padding-left: 1rem; 
        }
        
        .analysis-h3 { 
            font-size: 1.15rem; 
            font-weight: 600; 
            color: #1e293b; 
            margin-top: 1.25rem; 
            margin-bottom: 0.625rem; 
        }
        
        .analysis-p { 
            color: #475569; 
            margin-bottom: 1rem; 
            line-height: 1.7;
        }
        
        .analysis-ul { 
            list-style: disc; 
            margin-left: 1.75rem; 
            margin-bottom: 1rem; 
            color: #475569; 
            line-height: 1.7;
        }
        
        .analysis-tool { 
            background: linear-gradient(to right, #f1f5f9, #ffffff);
            border: 1px solid #e2e8f0; 
            border-left: 3px solid #3498db; /* 依照建議 3.1 調整 */
            border-radius: 0.5rem; 
            padding: 1rem 1.25rem; 
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        
        .analysis-tool:hover {
            border-left-width: 4px;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.1); /* 依照建議 3.1 調整 */
        }
        
        .analysis-tool strong { 
            color: #0f766e; /* 分析頁面的顏色可保持，以示區別 */
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .stage-title {
                font-size: 1.5rem;
            }
            
            .tool-label {
                font-size: 1.1rem;
            }
            
            /* 舊的 grid media query 已被 .toolkit 取代 */
            
            .tab-btn {
                font-size: 0.875rem;
                padding: 0.75rem 1rem;
            }
        }
        
        /* --- 載入與通知 --- */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
            margin-left: 0.5rem;
        }
        
        /* 修正 4.1: 已在 JS 中實現 (showNotification) */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            max-width: 90vw;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 text-slate-800 min-h-screen">

    <div class="container mx-auto max-w-screen-xl p-4 sm:p-6 lg:p-10 bg-white rounded-2xl shadow-2xl my-6 sm:my-12">

        <div class="mb-8 border-b-2 border-slate-200 no-print">
            <nav class="tab-buttons" aria-label="Tabs">
                <button id="tab-btn-analysis" class="tab-btn active">📚 策略分析</button>
                <button id="tab-btn-startup" class="tab-btn inactive">🌱 創業期</button>
                <button id="tab-btn-growth" class="tab-btn inactive">🚀 成長期</button>
                <button id="tab-btn-maturity" class="tab-btn inactive">🌳 成熟期</button>
                <button id="tab-btn-decline" class="tab-btn inactive">🍂 衰退/轉型期</button>
            </nav>
        </div>
        
        <div class="mb-8">
            <label for="ws-topic" class="text-xl font-semibold text-gray-800 block mb-2"> 📋 分析對象（公司/產品/專案）
            </label>
            <input type="text" id="ws-topic" class="worksheet-input" placeholder="請輸入要分析的公司名稱、產品線或專案名稱..." style="min-height: 50px;">
        </div>
        
        <hr class="my-8 border-slate-300">

        <div id="tab-content-analysis" class="tab-content active">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-6 pb-4 border-b-2 border-slate-200 text-center">
                <span class="bg-gradient-to-r from-blue-600 to-blue-500 bg-clip-text text-transparent"> 商業生命週期與策略工具整合指南
                </span>
            </h1>
            
            <p class="analysis-p mb-10 text-lg">
                企業如同生命體，會經歷不同的發展階段。理解公司當前所處的生命週期階段，並選擇適當的戰略工具，是制定有效策略的關鍵。本工具整合了生命週期理論與經典策略框架，幫助您更系統化地思考。
            </p>

            <section class="analysis-section">
                <h2 class="analysis-h2">🌱 1. 創業/導入期</h2>
                <h3 class="analysis-h3">階段重點：</h3>
                <ul class="analysis-ul">
                    <li><strong>核心目標：</strong>存活、驗證商業模式、尋找產品市場契合度 (PMF)</li>
                    <li><strong>主要挑戰：</strong>資源有限、市場認知度低、高度不確定性、驗證可行性</li>
                </ul>
                <h3 class="analysis-h3">關鍵工具運用：</h3>
                <div class="analysis-tool">
                    <strong>SWOT 分析：</strong>快速評估初始內部條件（優勢/劣勢）與外部環境（機會/威脅），建立基準認知。
                </div>
                <div class="analysis-tool">
                    <strong>VRIO 框架：</strong>問「我們為什麼會贏？」是否擁有獨特、難以模仿的資源？識別並保護早期優勢。
                </div>
                <div class="analysis-tool">
                    <strong>波特五力分析：</strong>初步評估目標市場的吸引力，幫助選擇初始進入點。
                </div>
            </section>
            
            <section class="analysis-section">
                <h2 class="analysis-h2">🚀 2. 成長期</h2>
                <h3 class="analysis-h3">階段重點：</h3>
                <ul class="analysis-ul">
                    <li><strong>核心目標：</strong>有效擴張規模、爭奪市場份額、建立品牌與競爭護城河</li>
                    <li><strong>主要挑戰：</strong>管理擴張複雜性、應對激烈競爭、保持高速成長</li>
                </ul>
                <h3 class="analysis-h3">關鍵工具運用：</h3>
                <div class="analysis-tool">
                    <strong>安索夫矩陣：</strong>系統性思考成長路徑，指導資源配置。
                </div>
                <div class="analysis-tool">
                    <strong>波特五力分析：</strong>深度分析產業結構，制定競爭策略。
                </div>
                <div class="analysis-tool">
                    <strong>BCG 矩陣：</strong>評估多事業單位，決定資源分配。
                </div>
            </section>
            
            <section class="analysis-section">
                <h2 class="analysis-h2">🌳 3. 成熟期</h2>
                <h3 class="analysis-h3">階段重點：</h3>
                <ul class="analysis-ul">
                    <li><strong>核心目標：</strong>維持利潤與市佔率、提升效率、尋找新成長動能</li>
                    <li><strong>主要挑戰：</strong>應對激烈競爭、管理客戶關係、克服組織僵化</li>
                </ul>
                <h3 class="analysis-h3">關鍵工具運用：</h3>
                <div class="analysis-tool">
                    <strong>波特基本策略：</strong>明確核心戰略，避免陷入「中間狀態」。
                </div>
                <div class="analysis-tool">
                    <strong>BCG 矩陣：</strong>管理「金牛」事業以資助新投資。
                </div>
            </section>

            <section class="analysis-section">
                <h2 class="analysis-h2">🍂 4. 衰退/轉型期</h2>
                <h3 class="analysis-h3">階段重點：</h3>
                <ul class="analysis-ul">
                    <li><strong>核心目標：</strong>優雅退出或尋找「第二曲線」實現轉型</li>
                    <li><strong>主要挑戰：</strong>決策退出vs.轉型、重新配置資源、管理變革阻力</li>
                </ul>
                <h3 class="analysis-h3">關鍵工具運用：</h3>
                <div class="analysis-tool">
                    <strong>SWOT 分析：</strong>評估轉型可能性，決定退出或重生。
                </div>
                <div class="analysis-tool">
                    <strong>安索夫矩陣：</strong>考慮全新產品/市場組合的多角化。
                </div>
            </section>
            
            <hr class="my-10 border-slate-300">
            
            <section class="analysis-section">
                <h2 class="analysis-h2">✨ 總結與提醒</h2>
                <ul class="analysis-ul">
                    <li><strong>工具靈活性：</strong>各工具在不同階段都有用，只是側重點不同</li>
                    <li><strong>非線性路徑：</strong>生命週期可能跳躍、停滯或逆轉</li>
                    <li><strong>情境為王：</strong>工具選擇永遠取決於具體情境</li>
                    <li><strong>適應力至上：</strong>基於快速反饋的適應性策略才是王道</li>
                </ul>
            </section>
        </div>
        
        <div id="tab-content-startup" class="tab-content">
            <section class="stage-section">
                <h2 class="stage-title">🌱 創業/導入期</h2>
                
                <div class="stage-focus">
                    <h3>本階段重點</h3>
                    <ul>
                        <li><strong>核心目標：</strong>存活、驗證商業模式、尋找產品市場契合度</li>
                        <li><strong>主要挑戰：</strong>資源有限、市場認知度低、高度不確定性</li>
                    </ul>
                </div>

                <div class="tool-block">
                    <label class="tool-label">SWOT 分析</label>
                    <p class="tool-description">評估初始內部與外部條件</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="swot-s-startup" class="sub-label">優勢 (Strengths)</label>
                            <textarea id="swot-s-startup" class="worksheet-input" placeholder="例如：團隊背景、技術能力、獨特洞察..."></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-w-startup" class="sub-label">劣勢 (Weaknesses)</label>
                            <textarea id="swot-w-startup" class="worksheet-input" placeholder="例如：資金限制、經驗不足、資源限制..."></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-o-startup" class="sub-label">機會 (Opportunities)</label>
                            <textarea id="swot-o-startup" class="worksheet-input" placeholder="例如：市場空白、新趨勢、政策支持..."></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-t-startup" class="sub-label">威脅 (Threats)</label>
                            <textarea id="swot-t-startup" class="worksheet-input" placeholder="例如：潛在競爭者、法規不明、技術風險..."></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">VRIO 框架</label>
                    <p class="tool-description">識別早期獨特且可防守的優勢</p>
                    <div class="input-group mb-4">
                        <label for="vrio-resource-startup" class="sub-label">識別核心資源/能力：</label>
                        <textarea id="vrio-resource-startup" class="worksheet-input" placeholder="列出潛在的早期優勢（例如：創辦人洞察、專利、特殊管道...）"></textarea>
                    </div>
                    <div class="toolkit"> <div class="input-group">
                            <label for="vrio-v-startup" class="sub-label">價值性 (Value)</label>
                            <textarea id="vrio-v-startup" class="worksheet-input" placeholder="是否有助於把握機會或中和威脅？能否創造客戶價值？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-r-startup" class="sub-label">稀缺性 (Rarity)</label>
                            <textarea id="vrio-r-startup" class="worksheet-input" placeholder="有多少競爭者擁有這項資源？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-i-startup" class="sub-label">難以模仿性 (Imitability)</label>
                            <textarea id="vrio-i-startup" class="worksheet-input" placeholder="競爭者模仿的成本是否很高？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-o-startup" class="sub-label">組織性 (Organization)</label>
                            <textarea id="vrio-o-startup" class="worksheet-input" placeholder="公司是否有組織來利用此資源？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="vrio-sustain-startup" class="sub-label">可持續性與保護策略：</label>
                        <textarea id="vrio-sustain-startup" class="worksheet-input" placeholder="基於 VRIO 分析，我們的持續優勢是什麼？如何保護/強化？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">波特五力分析</label>
                    <p class="tool-description">評估基本市場吸引力</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="5f-entrants-startup" class="sub-label">新進入者威脅</label>
                            <textarea id="5f-entrants-startup" class="worksheet-input" placeholder="進入這個市場容易嗎？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-buyers-startup" class="sub-label">買方議價能力</label>
                            <textarea id="5f-buyers-startup" class="worksheet-input" placeholder="早期客戶是否有很多選擇？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-suppliers-startup" class="sub-label">供應商議價能力</label>
                            <textarea id="5f-suppliers-startup" class="worksheet-input" placeholder="關鍵供應商是否稀缺或強勢？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-substitutes-startup" class="sub-label">替代品威脅</label>
                            <textarea id="5f-substitutes-startup" class="worksheet-input" placeholder="是否有其他方式滿足客戶需求？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-rivalry-startup" class="sub-label">競爭強度</label>
                            <textarea id="5f-rivalry-startup" class="worksheet-input" placeholder="誰是直接對手？他們強大嗎？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="5f-conclusion-startup" class="sub-label">初步結論與進入點：</label>
                        <textarea id="5f-conclusion-startup" class="worksheet-input" placeholder="基於五力分析，這個市場有吸引力嗎？什麼進入點可以避開最大壓力？"></textarea>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="tab-content-growth" class="tab-content">
            <section class="stage-section">
                <h2 class="stage-title">🚀 成長期</h2>
                <div class="stage-focus">
                    <h3>本階段重點</h3>
                    <ul>
                        <li><strong>核心目標：</strong>有效擴張規模、爭奪市場份額、建立品牌</li>
                        <li><strong>主要挑戰：</strong>管理擴張複雜性、應對激烈競爭</li>
                    </ul>
                </div>

                <div class="tool-block">
                    <label class="tool-label">安索夫矩陣</label>
                    <p class="tool-description">系統性思考成長路徑與資源配置</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="ansoff-mp-growth" class="sub-label">市場滲透</label>
                            <textarea id="ansoff-mp-growth" class="worksheet-input" placeholder="如何向現有市場銷售更多現有產品？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-pd-growth" class="sub-label">產品開發</label>
                            <textarea id="ansoff-pd-growth" class="worksheet-input" placeholder="如何向現有市場銷售新產品？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-md-growth" class="sub-label">市場開發</label>
                            <textarea id="ansoff-md-growth" class="worksheet-input" placeholder="如何向新市場銷售現有產品？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-d-growth" class="sub-label">多角化</label>
                            <textarea id="ansoff-d-growth" class="worksheet-input" placeholder="是否應進入新產品/市場領域？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="ansoff-priority-growth" class="sub-label">主要成長引擎與資源配置：</label>
                        <textarea id="ansoff-priority-growth" class="worksheet-input" placeholder="我們的主要成長引擎是什麼？資源應如何配置？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">波特五力分析</label>
                    <p class="tool-description">深度分析產業結構與競爭動態</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="5f-entrants-growth" class="sub-label">新進入者威脅</label>
                            <textarea id="5f-entrants-growth" class="worksheet-input" placeholder="進入障礙有多高？如何提高？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-buyers-growth" class="sub-label">買方議價能力</label>
                            <textarea id="5f-buyers-growth" class="worksheet-input" placeholder="如何降低買方力量？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-suppliers-growth" class="sub-label">供應商議價能力</label>
                            <textarea id="5f-suppliers-growth" class="worksheet-input" placeholder="如何降低供應商力量？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-substitutes-growth" class="sub-label">替代品威脅</label>
                            <textarea id="5f-substitutes-growth" class="worksheet-input" placeholder="如何與替代品競爭？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-rivalry-growth" class="sub-label">競爭強度</label>
                            <textarea id="5f-rivalry-growth" class="worksheet-input" placeholder="如何脫穎而出？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="5f-implications-growth" class="sub-label">策略意涵：</label>
                        <textarea id="5f-implications-growth" class="worksheet-input" placeholder="應採取哪些防守或進攻行動？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">BCG 矩陣</label>
                    <p class="tool-description">評估事業單位並配置資源</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="bcg-stars-growth" class="sub-label">明星事業 (Stars)</label>
                            <span class="sub-label-hint">(高成長、高市佔)</span>
                            <textarea id="bcg-stars-growth" class="worksheet-input" placeholder="列出「明星」事業與策略"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-questions-growth" class="sub-label">問題事業 (Question Marks)</label>
                            <span class="sub-label-hint">(高成長、低市佔)</span>
                            <textarea id="bcg-questions-growth" class="worksheet-input" placeholder="列出「問題」事業與策略"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-cows-growth" class="sub-label">金牛事業 (Cash Cows)</label>
                            <span class="sub-label-hint">(低成長、高市佔)</span>
                            <textarea id="bcg-cows-growth" class="worksheet-input" placeholder="列出「金牛」事業與策略"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-dogs-growth" class="sub-label">狗事業 (Dogs)</label>
                            <span class="sub-label-hint">(低成長、低市佔)</span>
                            <textarea id="bcg-dogs-growth" class="worksheet-input" placeholder="列出「狗」事業與策略"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="bcg-implications-growth" class="sub-label">資源配置意涵：</label>
                        <textarea id="bcg-implications-growth" class="worksheet-input" placeholder="現金流應如何在各單位間流動？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">經驗曲線</label>
                    <p class="tool-description">考慮成本優勢與定價策略</p>
                    <textarea id="ws-growth-ec" class="worksheet-input" placeholder="經驗曲線效應是否顯著？是否應使用策略定價？"></textarea>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">VRIO 框架</label>
                    <p class="tool-description">重新評估並強化優勢的可持續性</p>
                    <div class="input-group mb-4">
                        <label for="vrio-resource-growth" class="sub-label">識別核心資源/能力：</label>
                        <textarea id="vrio-resource-growth" class="worksheet-input" placeholder="列出成長期間建立的關鍵優勢"></textarea>
                    </div>
                    <div class="toolkit"> <div class="input-group">
                            <label for="vrio-v-growth" class="sub-label">價值性 (Value)</label>
                            <textarea id="vrio-v-growth" class="worksheet-input" placeholder="是否有助於把握機會或中和威脅？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-r-growth" class="sub-label">稀缺性 (Rarity)</label>
                            <textarea id="vrio-r-growth" class="worksheet-input" placeholder="有多少競爭者擁有這項資源？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-i-growth" class="sub-label">難以模仿性 (Imitability)</label>
                            <textarea id="vrio-i-growth" class="worksheet-input" placeholder="競爭者模仿的成本是否很高？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-o-growth" class="sub-label">組織性 (Organization)</label>
                            <textarea id="vrio-o-growth" class="worksheet-input" placeholder="公司是否有組織來利用此資源？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="vrio-sustain-growth" class="sub-label">可持續性與強化策略：</label>
                        <textarea id="vrio-sustain-growth" class="worksheet-input" placeholder="如何持續強化並防止侵蝕？"></textarea>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="tab-content-maturity" class="tab-content">
            <section class="stage-section">
                <h2 class="stage-title">🌳 成熟期</h2>
                <div class="stage-focus">
                    <h3>本階段重點</h3>
                    <ul>
                        <li><strong>核心目標：</strong>維持利潤與市佔率、提升效率</li>
                        <li><strong>主要挑戰：</strong>應對激烈競爭、克服組織僵化</li>
                    </ul>
                </div>

                <div class="tool-block">
                    <label class="tool-label">波特五力分析</label>
                    <p class="tool-description">監控激烈競爭並尋找降低競爭強度的方法</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="5f-entrants-maturity" class="sub-label">新進入者威脅</label>
                            <textarea id="5f-entrants-maturity" class="worksheet-input" placeholder="進入障礙是否仍然有效？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-buyers-maturity" class="sub-label">買方議價能力</label>
                            <textarea id="5f-buyers-maturity" class="worksheet-input" placeholder="如何提升忠誠度/轉換成本？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-suppliers-maturity" class="sub-label">供應商議價能力</label>
                            <textarea id="5f-suppliers-maturity" class="worksheet-input" placeholder="供應商格局有何變化？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-substitutes-maturity" class="sub-label">替代品威脅</label>
                            <textarea id="5f-substitutes-maturity" class="worksheet-input" placeholder="替代品是否變得更有吸引力？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="5f-rivalry-maturity" class="sub-label">競爭強度</label>
                            <textarea id="5f-rivalry-maturity" class="worksheet-input" placeholder="如何避免價格戰？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="5f-implications-maturity" class="sub-label">策略意涵：</label>
                        <textarea id="5f-implications-maturity" class="worksheet-input" placeholder="如何在成熟市場中維持獲利能力？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">波特基本策略</label>
                    <p class="tool-description">定義核心競爭策略，避免「中間狀態」</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="generic-cost-maturity" class="sub-label">成本領導</label>
                            <textarea id="generic-cost-maturity" class="worksheet-input" placeholder="如何在整個價值鏈中降低成本？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="generic-diff-maturity" class="sub-label">差異化</label>
                            <textarea id="generic-diff-maturity" class="worksheet-input" placeholder="差異化的基礎是什麼？是否可持續？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="generic-focus-maturity" class="sub-label">聚焦</label>
                            <textarea id="generic-focus-maturity" class="worksheet-input" placeholder="聚焦於哪個利基？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="generic-stuck-maturity" class="sub-label">是否陷入「中間狀態」？</label>
                        <textarea id="generic-stuck-maturity" class="worksheet-input" placeholder="我們的策略是否清晰？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">BCG 矩陣</label>
                    <p class="tool-description">管理「金牛」事業以資助新投資</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="bcg-stars-maturity" class="sub-label">明星事業</label>
                            <span class="sub-label-hint">(高成長、高市佔)</span>
                            <textarea id="bcg-stars-maturity" class="worksheet-input" placeholder="是否還有剩餘的「明星」？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-questions-maturity" class="sub-label">問題事業</label>
                            <span class="sub-label-hint">(高成長、低市佔)</span>
                            <textarea id="bcg-questions-maturity" class="worksheet-input" placeholder="是否有新的「問題」？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-cows-maturity" class="sub-label">金牛事業</label>
                            <span class="sub-label-hint">(低成長、高市佔)</span>
                            <textarea id="bcg-cows-maturity" class="worksheet-input" placeholder="如何最大化現金流？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-dogs-maturity" class="sub-label">狗事業</label>
                            <span class="sub-label-hint">(低成長、低市佔)</span>
                            <textarea id="bcg-dogs-maturity" class="worksheet-input" placeholder="策略為何？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="bcg-implications-maturity" class="sub-label">資源配置意涵：</label>
                        <textarea id="bcg-implications-maturity" class="worksheet-input" placeholder="「金牛」資金應流向何處？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">安索夫矩陣</label>
                    <p class="tool-description">尋找新成長機會</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="ansoff-mp-maturity" class="sub-label">市場滲透</label>
                            <textarea id="ansoff-mp-maturity" class="worksheet-input" placeholder="是否還有滲透空間？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-pd-maturity" class="sub-label">產品開發</label>
                            <textarea id="ansoff-pd-maturity" class="worksheet-input" placeholder="向現有客戶銷售新產品的機會？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-md-maturity" class="sub-label">市場開發</label>
                            <textarea id="ansoff-md-maturity" class="worksheet-input" placeholder="能否將現有產品帶到新市場？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-d-maturity" class="sub-label">多角化</label>
                            <textarea id="ansoff-d-maturity" class="worksheet-input" placeholder="是否該考慮多角化？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="ansoff-priority-maturity" class="sub-label">主要新成長向量：</label>
                        <textarea id="ansoff-priority-maturity" class="worksheet-input" placeholder="最可行的新成長路徑是什麼？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">SWOT 分析（重新評估）</label>
                    <p class="tool-description">定期檢視變化</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="swot-s-maturity" class="sub-label">優勢 (S)</label>
                            <textarea id="swot-s-maturity" class="worksheet-input" placeholder="我們的優勢是否仍然穩固？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-w-maturity" class="sub-label">劣勢 (W)</label>
                            <textarea id="swot-w-maturity" class="worksheet-input" placeholder="新的劣勢？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-o-maturity" class="sub-label">機會 (O)</label>
                            <textarea id="swot-o-maturity" class="worksheet-input" placeholder="新的機會？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-t-maturity" class="sub-label">威脅 (T)</label>
                            <textarea id="swot-t-maturity" class="worksheet-input" placeholder="破壞性威脅？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="swot-implications-maturity" class="sub-label">策略意涵：</label>
                        <textarea id="swot-implications-maturity" class="worksheet-input" placeholder="應該強化、優化、轉型還是準備轉型？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">VRIO 框架</label>
                    <p class="tool-description">確保核心資源的可持續性</p>
                    <div class="input-group mb-4">
                        <label for="vrio-resource-maturity" class="sub-label">識別核心資源/能力：</label>
                        <textarea id="vrio-resource-maturity" class="worksheet-input" placeholder="列出我們競爭所依賴的核心優勢"></textarea>
                    </div>
                    <div class="toolkit"> <div class="input-group">
                            <label for="vrio-v-maturity" class="sub-label">價值性 (V)</label>
                            <textarea id="vrio-v-maturity" class="worksheet-input" placeholder="這項資源是否仍有價值？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-r-maturity" class="sub-label">稀缺性 (R)</label>
                            <textarea id="vrio-r-maturity" class="worksheet-input" placeholder="是否仍然稀缺？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-i-maturity" class="sub-label">難以模仿性 (I)</label>
                            <textarea id="vrio-i-maturity" class="worksheet-input" placeholder="對手是否已模仿？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-o-maturity" class="sub-label">組織性 (O)</label>
                            <textarea id="vrio-o-maturity" class="worksheet-input" placeholder="組織是否仍能有效利用？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="vrio-sustain-maturity" class="sub-label">可持續性與強化策略：</label>
                        <textarea id="vrio-sustain-maturity" class="worksheet-input" placeholder="如何維持或重塑 VRIO 特性？"></textarea>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="tab-content-decline" class="tab-content">
            <section class="stage-section">
                <h2 class="stage-title">🍂 衰退/轉型期</h2>
                <div class="stage-focus">
                    <h3>本階段重點</h3>
                    <ul>
                        <li><strong>核心目標：</strong>優雅退出或尋找「第二曲線」</li>
                        <li><strong>主要挑戰：</strong>決策退出vs.轉型、管理變革阻力</li>
                    </ul>
                </div>

                <div class="tool-block">
                    <label class="tool-label">SWOT 分析</label>
                    <p class="tool-description">冷靜評估情況：退出還是轉型</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="swot-s-decline" class="sub-label">優勢 (S)</label>
                            <textarea id="swot-s-decline" class="worksheet-input" placeholder="有哪些優勢可轉移到新領域？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-w-decline" class="sub-label">劣勢 (W)</label>
                            <textarea id="swot-w-decline" class="worksheet-input" placeholder="哪些劣勢加速了衰退？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-o-decline" class="sub-label">機會 (O)</label>
                            <textarea id="swot-o-decline" class="worksheet-input" placeholder="是否有真正的轉型機會？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="swot-t-decline" class="sub-label">威脅 (T)</label>
                            <textarea id="swot-t-decline" class="worksheet-input" placeholder="導致衰退的威脅是否不可逆？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="swot-decision-decline" class="sub-label">初步決策：</label>
                        <textarea id="swot-decision-decline" class="worksheet-input" placeholder="傾向於收割/退出還是轉型/重生？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">BCG 矩陣</label>
                    <p class="tool-description">識別並管理「狗」事業</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="bcg-stars-decline" class="sub-label">明星事業</label>
                            <span class="sub-label-hint">(高成長、高市佔)</span>
                            <textarea id="bcg-stars-decline" class="worksheet-input" placeholder="是否還有剩餘？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-questions-decline" class="sub-label">問題事業</label>
                            <span class="sub-label-hint">(高成長、低市佔)</span>
                            <textarea id="bcg-questions-decline" class="worksheet-input" placeholder="是否還有剩餘？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-cows-decline" class="sub-label">金牛事業</label>
                            <span class="sub-label-hint">(低成長、高市佔)</span>
                            <textarea id="bcg-cows-decline" class="worksheet-input" placeholder="是否還有現金流可收割？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="bcg-dogs-decline" class="sub-label">狗事業</label>
                            <span class="sub-label-hint">(低成長、低市佔)</span>
                            <textarea id="bcg-dogs-decline" classs="worksheet-input" placeholder="哪些是「狗」？策略為何？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="bcg-implications-decline" class="sub-label">資源退出策略：</label>
                        <textarea id="bcg-implications-decline" class="worksheet-input" placeholder="如何退出「狗」事業？如何最大化殘值？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">安索夫矩陣（轉型焦點）</label>
                    <p class="tool-description">考慮全新的產品/市場組合</p>
                    <div class="toolkit"> <div class="input-group">
                            <label for="ansoff-mp-decline" class="sub-label">市場滲透</label>
                            <textarea id="ansoff-mp-decline" class="worksheet-input" placeholder="（通常在此階段不相關）"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-pd-decline" class="sub-label">產品開發</label>
                            <textarea id="ansoff-pd-decline" class="worksheet-input" placeholder="透過新產品轉型的機會？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-md-decline" class="sub-label">市場開發</label>
                            <textarea id="ansoff-md-decline" class="worksheet-input" placeholder="能否將產品帶到新市場？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="ansoff-d-decline" class="sub-label">多角化</label>
                            <textarea id="ansoff-d-decline" class="worksheet-input" placeholder="進入哪個新產品/市場？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="ansoff-renewal-decline" class="sub-label">「第二曲線」選擇：</label>
                        <textarea id="ansoff-renewal-decline" class="worksheet-input" placeholder="最可行的轉型路徑是什麼？"></textarea>
                    </div>
                </div>
                
                <div class="tool-block">
                    <label class="tool-label">VRIO 框架（轉型焦點）</label>
                    <p class="tool-description">盤點可轉移資源並規劃新資源</p>
                    <div class="input-group mb-4">
                        <label for="vrio-resource-decline" class="sub-label">識別可轉移的核心資源/能力：</label>
                        <textarea id="vrio-resource-decline" class="worksheet-input" placeholder="哪些現有 VRIO 資源可轉移到新領域？"></textarea>
                    </div>
                    <div class="toolkit"> <div class="input-group">
                            <label for="vrio-v-decline" class="sub-label">價值性（在新領域）</label>
                            <textarea id="vrio-v-decline" class="worksheet-input" placeholder="在新領域中是否有價值？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-r-decline" class="sub-label">稀缺性（在新領域）</label>
                            <textarea id="vrio-r-decline" class="worksheet-input" placeholder="在新領域中是否稀缺？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-i-decline" class="sub-label">難以模仿性（在新領域）</label>
                            <textarea id="vrio-i-decline" class="worksheet-input" placeholder="在那裡是否難以模仿？"></textarea>
                        </div>
                        <div class="input-group">
                            <label for="vrio-o-decline" class="sub-label">組織性（為新領域）</label>
                            <textarea id="vrio-o-decline" class="worksheet-input" placeholder="組織能否適應以新方式利用它？"></textarea>
                        </div>
                    </div>
                    <div class="input-group mt-4">
                        <label for="vrio-gap-decline" class="sub-label">所需的新 VRIO 資源/能力：</label>
                        <textarea id="vrio-gap-decline" class="worksheet-input" placeholder="轉型成功需要哪些「新」VRIO 資源？如何獲得？"></textarea>
                    </div>
                </div>
            </section>
        </div>

        <div class="text-center mt-12 space-y-4 no-print">
            <div class="flex flex-wrap justify-center gap-4">
                <button id="saveButton" class="btn-base btn-blue focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    💾 儲存至瀏覽器
                </button>
                <button id="loadButton" class="btn-base btn-blue focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    📂 載入已儲存資料
                </button>
                <button id="exportButton" class="btn-base btn-blue export-btn focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                    🚀 匯出為 Word 文件
                </button>
            </div>
            <p class="text-sm text-slate-500 mt-2">
                💡 提示：定期儲存您的工作，避免資料遺失
            </p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const tabs = {
            analysis: { btn: document.getElementById('tab-btn-analysis'), content: document.getElementById('tab-content-analysis') },
            startup: { btn: document.getElementById('tab-btn-startup'), content: document.getElementById('tab-content-startup') },
            growth: { btn: document.getElementById('tab-btn-growth'), content: document.getElementById('tab-content-growth') },
            maturity: { btn: document.getElementById('tab-btn-maturity'), content: document.getElementById('tab-content-maturity') },
            decline: { btn: document.getElementById('tab-btn-decline'), content: document.getElementById('tab-content-decline') }
        };
        const exportButton = document.getElementById('exportButton');
        const saveButton = document.getElementById('saveButton');
        const loadButton = document.getElementById('loadButton');
        const wsTopic = document.getElementById('ws-topic');
        
        function setActiveTab(activeTabName) {
            Object.keys(tabs).forEach(tabName => {
                const isActive = tabName === activeTabName;
                if (tabs[tabName].btn) {
                    tabs[tabName].btn.classList.toggle('active', isActive);
                    tabs[tabName].btn.classList.toggle('inactive', !isActive);
                }
                if (tabs[tabName].content) {
                    tabs[tabName].content.classList.toggle('active', isActive);
                }
            });
        }

        Object.keys(tabs).forEach(tabName => {
            if (tabs[tabName].btn) {
                tabs[tabName].btn.addEventListener('click', () => setActiveTab(tabName));
            }
        });

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        saveButton.addEventListener('click', () => {
            try {
                const data = {};
                document.querySelectorAll('input[type="text"], textarea').forEach(el => {
                    if (el.id) {
                        data[el.id] = el.value;
                    }
                });
                
                const timestamp = new Date().toLocaleString('zh-TW');
                data._savedAt = timestamp;
                
                localStorage.setItem('businessLifecycleData', JSON.stringify(data));
                showNotification(`✅ 資料已成功儲存（${timestamp}）`, 'success');
            } catch (error) {
                console.error('儲存失敗：', error);
                showNotification('❌ 儲存失敗，請稍後再試', 'error');
            }
        });

        loadButton.addEventListener('click', () => {
            try {
                const savedData = localStorage.getItem('businessLifecycleData');
                if (!savedData) {
                    showNotification('ℹ️ 尚無已儲存的資料', 'error');
                    return;
                }
                
                const data = JSON.parse(savedData);
                let loadedCount = 0;
                
                Object.keys(data).forEach(id => {
                    if (id !== '_savedAt') {
                        const el = document.getElementById(id);
                        if (el) {
                            el.value = data[id];
                            loadedCount++;
                        }
                    }
                });
                
                const savedAt = data._savedAt || '未知時間';
                showNotification(`✅ 已載入 ${loadedCount} 個欄位（儲存於 ${savedAt}）`, 'success');
            } catch (error) {
                console.error('載入失敗：', error);
                showNotification('❌ 載入失敗，資料可能已損壞', 'error');
            }
        });

        exportButton.addEventListener('click', function() {
            const originalText = exportButton.innerHTML;
            exportButton.innerHTML = '⏳ 處理中...<span class="loading"></span>';
            exportButton.disabled = true;
            
            setTimeout(() => {
                try {
                    const exportWrapper = document.createElement('div');
                    const mainTitleText = "商業生命週期策略工作表";

                    const titleH1 = document.createElement('h1');
                    titleH1.textContent = mainTitleText;
                    exportWrapper.appendChild(titleH1);

                    if (wsTopic && wsTopic.value.trim()) {
                        const topicH3 = document.createElement('h3');
                        topicH3.style.fontSize = '14pt'; 
                        topicH3.style.textAlign = 'center';
                        topicH3.style.marginBottom = '20px';
                        topicH3.textContent = "分析對象：" + wsTopic.value;
                        exportWrapper.appendChild(topicH3);
                    }
                    
                    const stageOrder = ['startup', 'growth', 'maturity', 'decline'];
                    let hasAnyContent = false;
                    
                    stageOrder.forEach(stageKey => {
                        const stageTabContent = document.getElementById(`tab-content-${stageKey}`);
                        if (!stageTabContent) return; 

                        const stageSection = stageTabContent.querySelector('.stage-section');
                        if (!stageSection) return;
                        
                        let hasContent = false;
                        stageSection.querySelectorAll('textarea.worksheet-input').forEach(textarea => {
                            if (textarea.value.trim() !== '') {
                                hasContent = true;
                            }
                        });
                        
                        if (!hasContent) return;
                        hasAnyContent = true;

                        if (exportWrapper.querySelector('h2')) {
                            const pageBreak = document.createElement('p');
                            pageBreak.setAttribute('style', 'page-break-before: always;');
                            exportWrapper.appendChild(pageBreak);
                        }
                        
                        const hr = document.createElement('hr');
                        exportWrapper.appendChild(hr);

                        const stageTitle = stageSection.querySelector('.stage-title');
                        if (stageTitle) {
                            const stageH2 = document.createElement('h2');
                            stageH2.textContent = stageTitle.textContent.trim();
                            exportWrapper.appendChild(stageH2);
                        }
                        
                        const focusDiv = stageSection.querySelector('.stage-focus');
                        if(focusDiv) {
                            const focusClone = focusDiv.cloneNode(true);
                            focusClone.querySelectorAll('*').forEach(el => el.removeAttribute('class')); 
                            exportWrapper.appendChild(focusClone); 
                        }

                        stageSection.querySelectorAll('.tool-block').forEach(toolBlock => {
                            let toolHasContent = false;
                            toolBlock.querySelectorAll('textarea.worksheet-input').forEach(textarea => {
                                if (textarea.value.trim() !== '') {
                                    toolHasContent = true;
                                }
                            });
                            
                            if (!toolHasContent) return;
                            
                            const toolLabel = toolBlock.querySelector('.tool-label');
                            if (toolLabel) {
                                const toolH3 = document.createElement('h3');
                                toolH3.textContent = toolLabel.textContent.trim();
                                exportWrapper.appendChild(toolH3);
                            }
                            
                            const toolDescription = toolBlock.querySelector('.tool-description');
                            if (toolDescription) {
                                const descP = document.createElement('p');
                                descP.style.fontStyle = 'italic';
                                descP.style.fontSize = '10pt';
                                descP.style.color = '#6b7280';
                                descP.textContent = toolDescription.textContent.trim();
                                exportWrapper.appendChild(descP);
                            }

                            const singleTextarea = toolBlock.querySelector(':scope > textarea.worksheet-input');
                            if (singleTextarea && singleTextarea.value.trim()) {
                                const p = createParagraphFromInput(singleTextarea);
                                exportWrapper.appendChild(p);
                            }
                            
                            toolBlock.querySelectorAll('.input-group').forEach(group => {
                                const subLabel = group.querySelector('.sub-label');
                                const textarea = group.querySelector('textarea.worksheet-input');

                                if (subLabel && textarea && textarea.value.trim()) {
                                    const subH4 = document.createElement('h4');
                                    
                                    let labelText = subLabel.textContent.trim();
                                    const hintSpan = group.querySelector('.sub-label-hint');
                                    if (hintSpan) {
                                        labelText += ` ${hintSpan.textContent.trim()}`; 
                                    }
                                    subH4.textContent = labelText;
                                    
                                    exportWrapper.appendChild(subH4);
                                    const p = createParagraphFromInput(textarea);
                                    exportWrapper.appendChild(p);
                                } else if (textarea && !subLabel && textarea.value.trim()) {
                                    const p = createParagraphFromInput(textarea);
                                    exportWrapper.appendChild(p);
                                }
                            });
                        });
                    });
                    
                    if (!hasAnyContent) {
                        showNotification('ℹ️ 沒有要匯出的內容，請先填寫工作表', 'error');
                        exportButton.innerHTML = originalText;
                        exportButton.disabled = false;
                        return;
                    }
                    
                    function createParagraphFromInput(inputElement) {
                        const p = document.createElement('p');
                        if (inputElement.value && inputElement.value.trim() !== '') {
                            p.setAttribute('style', 'border: 1px solid #d1d5db; padding: 8px 10px; margin: 3px 0 12px 0; background-color: #f9fafb; white-space: pre-wrap; font-size: 10pt; color: #1f2937;');
                            p.textContent = inputElement.value;
                        }
                        return p;
                    }

                    const finalHtmlString = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="UTF-8">
                            <style>
                                body { font-family: 'Arial', 'Microsoft JhengHei', sans-serif; font-size: 11pt; line-height: 1.6; color: #374151; }
                                h1 { font-size: 20pt; text-align: center; font-weight: bold; color: #111827; margin-bottom: 15px;}
                                h2 { font-size: 16pt; font-weight: bold; color: #2980b9; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #a9d6f5; padding-bottom: 8px; } /* 顏色更新 */
                                h3 { font-size: 13pt; font-weight: bold; color: #1f2937; margin-top: 20px; margin-bottom: 10px; }
                                h4 { font-size: 11pt; font-weight: bold; color: #475569; margin-top: 12px; margin-bottom: 5px; }
                                p { margin-bottom: 15px; white-space: pre-wrap; }
                                ul { list-style: disc; margin-left: 25px; margin-bottom: 12px; font-size: 10pt; color: #2980b9; } /* 顏色更新 */
                                .stage-focus { background-color: #eaf5fb; border: 1px solid #a9d6f5; border-radius: 6px; padding: 12px 18px; margin-bottom: 20px; } /* 顏色更新 */
                                .stage-focus h3 { font-size: 12pt; color: #2980b9; margin-top: 8px; margin-bottom: 10px; border-bottom: none; } /* 顏色更新 */
                                hr { border: none; border-top: 1px dashed #9ca3af; margin: 30px 0; }
                            </style>
                        </head>
                        <body>
                            ${exportWrapper.innerHTML}
                        </body>
                        </html>
                    `;

                    const converted = htmlDocx.asBlob(finalHtmlString, {
                        orientation: 'portrait',
                        margins: { top: 720, bottom: 720, left: 720, right: 720 }
                    });

                    const filename = `${wsTopic.value || '商業生命週期策略工作表'}_${new Date().toISOString().slice(0,10)}.docx`;
                    saveAs(converted, filename);
                    
                    showNotification('✅ Word 文件已成功匯出！', 'success');

                } catch (error) {
                    console.error("匯出失敗：", error);
                    showNotification('❌ 匯出失敗，請檢查控制台', 'error');
                } finally {
                    exportButton.innerHTML = originalText;
                    exportButton.disabled = false;
                }
            }, 100);
        });
        
        setActiveTab('analysis');
        
        let autoSaveInterval;
        const startAutoSaveReminder = () => {
            clearInterval(autoSaveInterval);
            autoSaveInterval = setInterval(() => {
                const hasContent = Array.from(document.querySelectorAll('textarea.worksheet-input'))
                    .some(el => el.value.trim() !== '');
                if (hasContent) {
                    showNotification('💡 別忘了儲存您的工作進度！', 'success');
                }
            }, 600000);
        };
        
        startAutoSaveReminder();
    });
    </script>

</body>
</html>
